# Wanchain PoS星系共识

2019年6月26日，Wanchain 正式对外发布PoS星系共识（Galaxy Consensus）Beta测试版。星系共识是由Wanchain共识团队提出，基于多种密码学技术设计的可证明安全、带有完整委托机制和经济激励模型的实用PoS共识协议。星系共识Beta版的发布，是继今年3月31日共识技术黄皮书和概念原型的公布，5月18日Alpha版的推出之后，Wanchain团队在PoS共识机制的工程落地上取得了关键性胜利。

### 什么是共识（Consensus）？

共识是指分布式网络中节点对某一事实达成一致意见的过程。例如，比特币的共识就是指依据其规则和流程，网络中的节点对共享的交易记账结果达成一致意见。共识机制通过自我管理确保形成全网认可的唯一链条或账本以供使用，它激励参与者打包正确的区块，避免恶意成员控制或替换账本数据。
 
### 如何保证区块链网络达成正确的共识？

不同共识机制使用不同的方法保障共识结果的正确性，避免链上恶意节点裹胁正常节点确认不合法交易。比特币的共识机制采用工作量证明（PoW）来确保网络的安全，Wanchain、Tezos等其他一些公链系统则采用权益证明（PoS）来保障网络安全。
 
### PoW如何保护区块链网络的安全？

在比特币设计的PoW共识机制中，矿工节点通过解决一个需要大量算力的数学难题来将交易打包成合法区块，这就是PoW中工作量的由来。对于矿工来说，形成一个合法区块是十分困难的，他们彼此竞争以争夺出块权。当矿工在共识规则要求下产生了合法区块，经过网络验证和确认后，该矿工便能获得一定量的比特币奖励，以表示对他工作量的肯定。因为矿工需要耗费大量的算力和电力来完成出块，而不合法区块将不会得到确认和奖励，只会浪费矿工的资源，因此矿工只会打包合法交易，杜绝不合法交易上链。
 
### PoS如何确保区块链网络安全？

与PoW一样，PoS的目标同样是为了保障对一系列合法交易完成验证和确认，防止不合法交易被接受上链。PoW通过算力确保网络安全，而PoS则是通过纯粹的经济激励方式。在PoS共识机制中，节点通过质押一定数量的代币（比如在星系共识中质押WAN币）参与共识。在比特币PoW共识机制中，任何工作节点都可以收集交易、产生区块，而在PoS共识机制中，只有持有一定量权益的节点可以产生区块，这些PoS节点通过类似抽奖的方式决定谁来产生区块并获得奖励。如果某一节点违反了共识规则，例如试图将不合法的交易打包上链，那么该节点将自动受到惩罚。
 
### 为什么选择PoS？

正如前面所说，PoW需要大量算力的同时耗费大量的能源。一方面，运行PoW就需要购买昂贵的硬件设施以保证巨大的算力，这些硬件设施又会很快的更新换代而被淘汰，这就导致了大量的浪费和开销；另一方面，算力硬件的运行需要大量的能源支撑，这些来自不可再生资源的消耗将对全球污染产生严重影响。这些都不是我们想要的，所以设计出PoS共识机制。

### 星系共识（Galaxy Consensus）

星系共识借鉴了已有的优秀PoS共识方案，如Ouroboros，并对多个关键密码学组件进行创新设计。星系共识中，所有权益持有者（Stakeholder）共同组成了社区（Community），社区中的每一名成员都有机会参与共识并获得奖励，获得奖励的几率随WAN币的质押数量和锁定时间的提升而提高，而对加入社区的条件，我们设置了WAN币最低质押数量的门槛。同时，对可以接受委托的参与者即代理节点，我们提高了其WAN币质押数量的门槛。

### 星系共识的优势

星系共识是Wanchain自主设计的新型PoS共识协议，拥有安全稳健的委托机制。在星系共识中，所有参与质押的WAN代币持有者成为了我在前面提到的节点，也就是PoS中的验证节点，这些验证节点将有机会获得出块奖励。验证节点质押代币数量越大，质押时间越长，那么奖励就越多。
 
星系共识的特点有哪些？首先，我们的最底层的理论基础是以Ouroboros共识作为安全基础，Ouroboros是Cardano研发出来的共识，这个共识的一大特点是，它是工业界第一个被采用的可证明安全的PoS算法。
 
在这里我再给大家强调一点，在所有PoS共识机制中，有两个步骤尤为关键，一个是随机数生成过程，一个是出块者选择过程。在PoW中，下一个出块者身份是无法提前预测，那么怎么确定这个出块者呢，节点通过计算一个随机数来进行哈希碰撞。因此我们说在PoW共识系统下，谁来挖矿是随机的。而PoS不进行哈希碰撞，于是PoS引入了随机数生成算法。
 
Wanchain的星系共识中，我们在随机数生成算法上进行了大量的创新，设计了更加安全高效的随机数生成算法，random beacon。保证了随机数的产生是去中心化的，是不可预测的，无偏的，均匀分布的，保证输出的，以及公开可验证的，这六大衡量随机数算法优劣的六大标准。
 
再一个就是出块者选择算法。我们创新性地设计了Unique Leader SelectionULS算法，用于出块者选择，这个算法能够保证合法出块者的唯一性，大大降低了自然分叉的概率，缩短了共识时间。出块者选择兼具公平性、可验证性和匿名性。
 
### 星系共识中的关键角色

星系共识中有三个重要角色，一个是普通验证节点，一个是受托验证节点，一个是委托人。了解了这三个角色和这三个角色的要求，对大家后面参加Wanchain PoS尤为验证节点并质押的活动是非常有帮助的。

对于普通验证节点来讲，10000WAN是最低门槛，普通验证节点不能接收委托。受托验证节点最低门槛是50000WAN，可授受的委托比率是1：5。什么意思呢，就是当一个节点质押了50000WAN，它就能额外从社区里吸纳最高250000WAN的委托量，如果吸纳的量超了，则需要提高质押数量，从而提高委托量。同时，受托验证节点可以设置委托费率，0%-100%。0%就是不收委托费。

第三个角色就是委托人，最低委托数量是100WAN。委托人可以找任何自己信的过的受托验证节点，把自己的代币委托给它，赚取收益。

需要强调两点：

不管你是做普通验证节点还是受托验证节点，你都需要自建服务器或者租赁云服务。但如果你是做委托人，则不需要自建服务器或者租赁云服务。正因为如此，在相同WAN代币数量的情况下，验证节点的收益率是比委托人的收益率要高，但委托人没有运营方面的烦恼。

另一点就是委托人参与委托的资金是非常安全的，因为这是通过智能合约控制，自动返还本金和收益到委托人的地址上。
 
### 委托机制

再来说说星系共识中的委托机制，Wanchain的委托机制完全是在链上完成，这和市面上链下进行委托的PoS相比，对委托人来说更加安全。

受托验证节点，除了自己质押WAN代币外，为了提高收益，就需要不断的吸引更多的委托人将他们的代币投给你，这样你作为受托验证节点，最终收益也会水涨船高。所以委托机制的设立，能极大的调动受托验证节点的积极性。同时也降低了全社区所有成员参与共识的门槛。也就是说100WAN你就能成为委托人，10000WAN你就能成为验证节点，有机会参与随机数的生成和交易的打包出块。

这也是Wanchain PoS设计的初衷，我们把门槛做的很低，就是希望社区的成员都能有机会参与到共识中来，这也是完全符合区块链的设计理念的，全民共享，全民所有。
 
### 验证节点共识过程

以受托验证节点来举例：

第一步，用户需要通过市场购买至少50000WAN，在Wanchain网络上注册成为受托验证节点，然后把WAN代币打入受托节点的地址。这样，受托验证节点算是准备就绪了。

第二步，选择质押时间。受托节点可以选择14天至180天中的任意天数。确定好质押天数后，开启真正的质押。

第三步，在受托节点质押期间，受托节点可以主动吸引更多的委托人将代币委托给受托节点，这样总质押量增加，受托节点被选中出块的概率也会增加，奖励也就增加了。Wanchain网络每两天会从所有验证节点中选出75个节点并将他们分成两组，一组用来产生随机数，一组用来打包交易提出区块。只有被选入这75个节点中的一员的验证节点才能够获得奖励。Wanchain会每两天这75个节点。如果一个验证节点的质押量越大，质押时间越长，那么越容易被选中进入这75个节点的组里。这也是为什么，我们鼓励受托节点多吸引委托人的原因。

第四步，Wanchain的奖励每两天会自动结算一次，结算结果按照之前打出的地址原路返回到受托地址和委托人地址。所以委托人不用担心受托人会跑路的事情。整个质押结束后，本金会原路返回打出的地址。

Wanchain的质押特色：验证节点参与质押后，需要走完自己所选的整个质押过程，本金才能拿回。而对于委托人来说，他可以随时委托进来，随时提走委托资金。
 
### Staking收益

先强调两个点：

Wanchain总共发行了二亿一千万个WAN，其中白皮书就规定好了有10%是用于PoS的奖励的，也就是2100万个WAN。不同于市面上绝大多数PoS或类PoS项目，Wanchain没有增发机制，也就是没有通胀。因为通胀项目的年收益和非通胀项目的年收益是不好拿来直接比较的。

其次，Wanchain的PoS奖励发放按照先高后低的原则。首年的总奖励是250万个WAN，此后每年递减12%。

预估收益：

假设某个验证节点质押了10万个WAN，而区块链网络中总质押量是1000万个WAN，那么年化收益就是25%。

假设假设某个验证节点质押了10万个WAN，而区块链网络中总质押量是2000万个WAN，那么年化收益就是12.5%。

总质押量多了，一定会带来币本位收益的下降，但总质押量多了，就意味着总锁仓量多了，从某种角度来讲，会拉动币价对法币的价格。

同时，上述收益率计算只考虑了最重要的影响因子（验证节点质押量和所有验证节点质押总量），实际单个节点的收益率还需要考虑受托质押量、委托费收益、云租赁成本、锁定时长、在线活性、加密货币兑法币汇率变化等诸多因子。
